<!-- A "project" describes a set of targets that may be requested
     when Ant is executed.  The "default" attribute defines the
     target which is executed if no specific target is requested,
     and the "basedir" attribute defines the current working directory
     from which Ant executes the requested task.  This is normally
     set to the current working directory.
-->

<project name="share" default="deploy" basedir=".">
    <property name="app.name" value="share"/>
    <property name="cab.name" value="roboClient.cab"/>
    <property name="jar.name" value="roboClient.jar"/>
    <property name="build.home" value="build_applet"/>
    <property name="build.src" value="${build.home}/src"/>
    <property name="build.classes" value="${build.home}/classes"/>
    <property name="cab.dir" value="${build.home}/cabfiles"/>
    <property name="jar.dir" value="${build.home}/jarfiles"/>
    <property name="dist.dir" value="../distribution"/>
	<property name="application" value="share"/>	
    <property name="deploy.home" value="${dist.dir}/${application}"/>
    <property name="mstools.dir" value="c:\java\codesign"/>

<!--

  These properties control option settings on the Javac compiler when it
  is invoked using the <javac> task.

  compile.debug        Should compilation include the debug option?

  compile.deprecation  Should compilation include the deprecation option?

  compile.optimize     Should compilation include the optimize option?

-->

  <property name="compile.debug"       value="true"/>
  <property name="compile.deprecation" value="false"/>
  <property name="compile.optimize"    value="true"/>


    <!-- This is the target for building a web app -->
    <target name="compile" depends="prepare">
        <copy todir="${build.src}">
		<fileset dir="src">
			<patternset >
				<include name="**/*.java"/>
				<exclude name="**/*Server*"/>
				<exclude name="**/share/"/>
				<exclude name="**/net/*"/>
				<exclude name="**/server/*"/>
			</patternset> 
		</fileset>
        </copy>
        <javac srcdir="${build.src}" destdir="${build.classes}" debug="${compile.debug}" optimize="${compile.optimize}" deprecation="${compile.deprecation}" target="1.1"/>
    </target>

    <target name="build_cab" depends="compile">
        <copy todir="${cab.dir}">
		<fileset dir="${build.classes}">
			<patternset >
				<include name="**/*.class"/>
			</patternset> 
		</fileset>
        </copy>
        <exec executable="${mstools.dir}\cabarc.exe" dir="${cab.dir}">
        <arg line="-r -p N ${cab.name} com\*.class"/>
        </exec>
	  <move todir="${build.home}" file="${cab.dir}/${cab.name}" />

    </target>

    <target name="build_jar" depends="compile">
        <copy todir="${jar.dir}">
		<fileset dir="${build.classes}">
			<patternset >
				<include name="**/*.class"/>
			</patternset> 
		</fileset>
        </copy>
	<jar jarfile="${build.home}/${jar.name}" basedir="${jar.dir}" filesonly="true"/>
	<delete dir="jarfiles"/>
    </target>

    <target name="deploy" depends="build_jar, build_cab">
        <copy todir="${deploy.home}" file="${build.home}/${cab.name}"/>
        <copy todir="${deploy.home}" file="${build.home}/${jar.name}"/>
    </target>

<!-- ==================== Clean Target ==================================== -->

<!--

  The "clean" target deletes any previous "build" and "dist" directory,
  so that you can be ensured the application can be built from scratch.

-->
    <target name="clean" >
    <delete dir="${build.home}"/>
    </target>

<!-- ==================== Prepare Target ================================== -->

<!--

  The "prepare" target is used to create the "build" destination directory,
  and copy the static contents of your web application to it.  If you need
  to copy static files from external dependencies, you can customize the
  contents of this task.

  Normally, this task is executed indirectly when needed.

-->

  <target name="prepare">

    <!-- Create build directory and copy static content -->
    <mkdir  dir="${build.home}"/>
    <mkdir  dir="${build.src}"/>
    <mkdir  dir="${build.classes}"/>
  </target>

</project>
